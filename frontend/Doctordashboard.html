<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./styles/index.css">
    <style>
        .Newdoc {
            color: rgb(222, 64, 17);
        }

        .cardagain {
            display: flex;
            border: none;
            margin: 40px;
            box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
            font-family: sans-serif;
            border-radius: 10px;
            overflow: hidden;
        }

        .cardagain>div:nth-child(1) {
            text-align: center;
            padding: 20px;
            background-color: rgb(239, 239, 239);
        }

        .cardagain>div img {
            width: 100%;
            max-width: 200px;
            border-radius: 50%;
            box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
            border: 1px solid black;
            margin-top: 20px;
        }

        .cardagain>div {
            flex: 1;
            padding: 20px;
            font-size: 17px;
            color: rgb(50, 49, 49);
            background-color: white;
            border-radius: 10px;
        }

        .cardagain h3,
        .cardagain h5,
        .cardagain p {
            margin: 0;
        }

        .cardagain h3 {
            font-size: 1.3em;
            font-weight: bold;
        }

        .cardagain h5 {
            font-size: 1em;
            font-weight: bold;
        }

        .cardagain p {
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .cardagain p:last-child {
            margin-bottom: 0;
        }

        #appointmentdiv {
            margin-top: 20px;
        }

        #appointmentdiv h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        #appointment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        #appointment-table th,
        #appointment-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        #appointment-table th {
            font-weight: bold;
            background-color: #f2f2f2;
        }

        #appointment-table td:last-child {
            text-align: center;
        }

        #appointmentdiv {
            margin-top: 20px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 10px;
        }

        #appointmentdiv h2 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        #appointment-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            border: 1px solid #ddd;
        }

        #appointment-table th,
        #appointment-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
            border-right: 1px solid #ddd;
        }

        #appointment-table th:last-child,
        #appointment-table td:last-child {
            border-right: none;
        }

        #appointment-table th {
            font-weight: bold;
            background-color: #f2f2f2;
        }
        #updateForm {
            display: none;
    width: 500px;
    position: fixed;
    top:80px;
    left: 35%; 
    margin: 0 auto;
    padding: 20px;
    border: 1px solid #ccc;
    background-color: #e0dfdf ;
    border: 1px solid #ccc;
    border-radius: 5px;
    z-index: 1;
    box-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
  }
  #updateForm label {
    display: inline-block;
    width: 150px;
    font-weight: bold;
  }
  #updateForm select {
    width: 300px;
    padding: 5px;
    border: 1px solid #ccc;
    border-radius: 4px;
    margin-bottom: 10px;
  }
  #updateForm input[type="submit"] {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    margin-top: 20px;
  }
  
  #updateForm input[type="submit"]:hover {
    background-color: #45a049;
  }
  #closeButton {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: #000;
}

#closeButton:hover {
  color: #ff0000;
}
    </style>
</head>

<body>
    <div id="navbar">
        <div><img width="100px" height="70px" src="/DentDesk.png" alt="" /></div>
        <div><a href="index.html">Home</a></div>
        <div><a href="">Dashboard</a></div>
        <div><a href="">Login</a></div>
        <div><a href="">Sign Up</a></div>
    </div>

    <div id="our">
        <p>Home</p>
        <p>>></p>
        <p class="Newdoc">DoctorsDashboard</p>
    </div>
    <form id="updateForm">
        <button id="closeButton" type="button">&times;</button>
        <label for="status">Status:</label>
        <select id="status" name="status" required>
          <option value="scheduled">Scheduled</option>
          <option value="confirmed">Confirmed</option>
          <option value="completed">Completed</option>
          <option value="canceled">Canceled</option>
        </select>
        <input type="submit" value="Update">
      </form>
      
      
    <div id="Doctordetails">
        <div id="detailsdoc"></div>
        <div id="appointmentdiv">
            <h2>Appointments</h2>
            <table id="appointment-table">
                <thead>
                    <tr>
                        <th>Username</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Table rows will be dynamically populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
    <div id="footer">
        <div>
            <h2 class="heading">DentDesk Advantage</h2>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>

        </div>
        <div>
            <h2 class="heading">About Us</h2>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>

        </div>
        <div>
            <h2 class="heading">Careers</h2>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>
            <p>▶ Lorem ipsum.</p>


        </div>
        <div>
            <h2 class="heading">Call Us</h2>
            <p>▶ Lorem
            <p class="num">0245 4586 125</p>
            </p>
            <p>▶ Lorem
            <p class="num">0245 4586 125</p>
            </p>
            <p>▶ Lorem
            <p class="num">0245 4586 125</p>
            </p>

        </div>
    </div>
</body>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    let token = localStorage.getItem("token") || ""
    const user1 = JSON.parse(localStorage.getItem("user")) || "";
    let doctorid = localStorage.getItem("doctorID") || "";
    let AppointmentId= localStorage.getItem("AppointmentId") || "";

    
    
    let clsbtn = document.getElementById("closeButton")
    let updateform = document.getElementById("updateForm")
    let statusvl = document.getElementById("status")
    let formel = document.getElementById("updateForm")
    
    let tbodyEl = document.querySelector("tbody")


    window.addEventListener("load", () => {
        fetchdata()
        fetchdata1()
    })

    clsbtn.addEventListener("click",()=>{
        updateform.style.display="none"
    })
    async function fetchdata() {
        try {
            let res = await fetch(`http://localhost:4500/doctor/byname?name=${user1.name}&email=${user1.email}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `${token}`
                },
            })
                .then((res) => res.json())
                .then((data) => {
                    localStorage.setItem("doctorID", data.doctor[0]._id);
                    renderData(data.doctor)
                })

        } catch (error) {
            console.log(error)
        }
    }
   
    function renderData(doc) {
        let maincontainer = document.querySelector("#detailsdoc");
        maincontainer.innerHTML = "";

        let newarr = doc.map((item) => {
            return `
  <div class="cardagain">
      <div>
      <img src="${item.image}"> 
      </div>
      <div>
          <h3> <h5>Name:</h5>  ${item.name}</h3>
          <p> <h5>Phone:</h5> ${item.phone}</p>
          <p>  <h5>Qualification:</h5>  ${item.qualification}</p>
          <p> <h5>Experience:</h5>  ${item.experience}</p>
          <p>  <h5>Charge:</h5>  &#x20B9 ${item.charge}</p>
          </div>
          <div>
            <p><h5>Language:</h5>  ${item.language}</p>
            <p><h5>Expertise:</h5> ${item.about}</p> 
            <p>  <h5>Timings:</h5>  ${item.timings}</p>
            <p>  <h5>Location:</h5>${item.location}</p>
      </div>
  </div>
  `;
        });
        maincontainer.innerHTML = newarr.join(" ");
    }


    async function fetchdata1() {
        try {
            let res = await fetch(`http://localhost:4500/appointment/doctorAppointment/${doctorid}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": `${token}`
                },
            })
                .then((res) => res.json())
                .then((data) => {
                    console.log(data.data)
                    displayData(data.data)
                })

        } catch (error) {
            console.log(error)
        }
    }

    function displayData(data) {
        tbodyEl.innerHTML = "";
        data.forEach(async (element) => {
            let tr = document.createElement("tr");
            tr.setAttribute("data-id", element._id);

            let Username = document.createElement("td");
            let Dat = document.createElement("td");
            let Time = document.createElement("td");
            let Status = document.createElement("td");
            let Action = document.createElement("td");

            const date = new Date(element.date);
            const formattedDate = date.toLocaleString('en-US', { month: 'short', day: '2-digit', year: 'numeric' });
            Dat.innerText = formattedDate;
            Time.innerText = element.time;
            Status.innerText = element.status;
            await fetch(`http://localhost:4500/user/${element.user}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `${token}`,
                },
            }).then(res => res.json())
                .then(data => {
                    console.log(data.user.name)
                    Username.innerText = data.user.name
                }).catch((error) => {
                    console.log(error)
                })

            let button = document.createElement("button");
            button.innerText = "UPDATE";

            button.addEventListener("click", async function () {
                const AppointmentId = this.parentNode.parentNode.getAttribute("data-id");
                console.log(AppointmentId)
                localStorage.setItem("AppointmentId", AppointmentId);

                  updateform.style.display = 'block'

                  await fetch(`http://localhost:4500/appointment/appoint/${AppointmentId}`, {
                method: "GET",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `${token}`,
                },
            }).then(res => res.json())
                .then(data => {
                    console.log(data.appointment.status)
                    statusvl.value=data.appointment.status
                }).catch((error) => {
                    console.log(error)
                })
            });

            Action.appendChild(button);
            tr.append(Username, Dat, Time, Status, Action);
            tbodyEl.append(tr);
        });
    }
    formel.addEventListener("submit",async(e)=>{
        e.preventDefault()
        const requestBody = {
      status: statusvl.value
    };
    console.log(requestBody)
        await fetch(`http://localhost:4500/appointment/doctorAppointment/${AppointmentId}`, {
                method: "PATCH",
                headers: {
                    "Content-Type": "application/json",
                    Authorization: `${token}`,
                },
                body: JSON.stringify(requestBody)
            }).then(res => res.json())
                .then(data => {
                    if(data.msg==="Appointment Updated"){
                        Swal.fire({
                    position: "centre",
                    icon: "success",
                    title: "Mail Send",
                    showConfirmButton: false,
                    timer: 1500,
                });
                setTimeout(() => {
                    window.location.href = "Doctordashboard.html";
                }, 2500);
                    }else{
                        Swal.fire({
                    position: "centre",
                    icon: "error",
                    title: `${res.msg}`,
                    showConfirmButton: false,
                    timer: 1500,
                });
                    }
                }).catch((error) => {
                    console.log(error)
                })
             });
   
</script>

</html>